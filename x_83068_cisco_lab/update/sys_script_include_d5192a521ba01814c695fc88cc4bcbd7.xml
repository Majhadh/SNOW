<?xml version="1.0" encoding="UTF-8"?><record_update table="sys_script_include">
    <sys_script_include action="INSERT_OR_UPDATE">
        <access>public</access>
        <active>true</active>
        <api_name>x_83068_cisco_lab.GitCCSManager</api_name>
        <caller_access/>
        <client_callable>false</client_callable>
        <description/>
        <name>GitCCSManager</name>
        <script><![CDATA[var GitCCSManager = Class.create();
GitCCSManager.prototype = {
    initialize: function() {},

    _checkJobStatus: function(jobId, AccountId, APIKey) {
        try {
            var c3Url = gs.getProperty('x_83068_cisco_lab.git_c3_url');
            var url = c3Url + jobId + "?includeNodeDetails=true&includeTaskDetails=true&accessLink=true";
            var method = "GET";

            sm = new sn_ws.RESTMessageV2();
            sm.setHttpMethod(method);
            sm.setEndpoint(url);
            sm.setRequestHeader("Content-Type", "application/json");
            sm.setRequestHeader("Accept", "application/json");
            sm.setBasicAuth(AccountId, APIKey);

            // Execute the request
            var response = sm.execute();
            responseError = response.haveError() ? response.getErrorMessage() : "";
            responseBody = response.getBody();

            status = response.getStatusCode();

            var parseResponseBody = JSON.parse(responseBody);

            if (status < 200 || status >= 300) {
                gs.error("CHECKING JOB STATUS FOR ERRORS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
                //      return;
            } else {
                gs.info("CHECKING JOB STATUS: " + "\r\n STATUS CODE: " + status /*+  "\r\n RESPONSE: " + responseBody*/);
                return parseResponseBody;
            }
        } catch (error) {
            gs.error("CHECKING JOB STATUS FOR ERRORS (catch error): " + error.message + " Status Code: " + status);
            //   return;
        }
    },

    _getChildJob: function(childJobUrl, AccountId, APIKey) {
        try {
            var method = "GET";

            sm = new sn_ws.RESTMessageV2();
            sm.setHttpMethod(method);
            sm.setEndpoint(childJobUrl);
            sm.setRequestHeader("Content-Type", "application/json");
            sm.setRequestHeader("Accept", "application/json");
            sm.setBasicAuth(AccountId, APIKey);

            // Execute the request
            var response = sm.execute();
            responseError = response.haveError() ? response.getErrorMessage() : "";
            responseBody = response.getBody();
            status = response.getStatusCode();
            var parseResponseBody = JSON.parse(responseBody);

            if (status < 200 || status >= 300) {
                gs.error("CHECKING CHILD JOB STATUS FOR ERRORS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
            } else {
                gs.info("CHECKING CHILD JOB DETAILS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
                return parseResponseBody;
            }
        } catch (error) {
            gs.error("CHECKING CHILD JOB FOR ERRORS (catch error): " + error.message);
        }
    },

    _deleteJob: function(jobId, AccountId, APIKey) {
        try {
            var c3Url = gs.getProperty('x_83068_cisco_lab.git_c3_url');
            var url = c3Url + jobId;
            var method = "DELETE";

            sm = new sn_ws.RESTMessageV2();
            sm.setHttpMethod(method);
            sm.setEndpoint(url);
            sm.setRequestHeader("Content-Type", "application/json");
            sm.setRequestHeader("Accept", "application/json");
            sm.setBasicAuth(AccountId, APIKey);

            // Execute the request
            var response = sm.execute();
            responseError = response.haveError() ? response.getErrorMessage() : "";
            responseBody = response.getBody();

            status = response.getStatusCode();

            var parseResponseBody = JSON.parse(responseBody);

            if (status < 200 || status >= 300) {
                gs.error("ERROR - CHECKING JOB STATUS FOR ERRORS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
            } else if (parseResponseBody !== "") {
                gs.info("CHECKING JOB STATUS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
                return parseResponseBody;
            }
        } catch (error) {
            gs.error("CHECKING JOB STATUS FOR ERRORS (catch error): " + error.message);
        }
    },
    _checkDeleteJobStatus: function(jobId, AccountId, APIKey) {
        try {
            var c3Url = gs.getProperty('x_83068_cisco_lab.git_c3_url');
            var url = c3Url + jobId;
            var method = "GET";

            sm = new sn_ws.RESTMessageV2();
            sm.setHttpMethod(method);
            sm.setEndpoint(url);
            sm.setRequestHeader("Content-Type", "application/json");
            sm.setRequestHeader("Accept", "application/json");
            sm.setBasicAuth(AccountId, APIKey);

            // Execute the request
            var response = sm.execute();
            responseError = response.haveError() ? response.getErrorMessage() : "";
            responseBody = response.getBody();

            status = response.getStatusCode();

            var parseResponseBody = JSON.parse(responseBody);

            if (status < 200 || status >= 300) {
                gs.error("ERROR - CHECKING JOB STATUS FOR ERRORS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
            } else if (parseResponseBody != "") {
                gs.info("CHECKING JOB STATUS: " + "\r\n STATUS CODE: " + status + "\r\n RESPONSE: " + responseBody);
                return parseResponseBody;
            }
        } catch (error) {
            gs.error("CHECKING JOB STATUS FOR ERRORS (catch error): " + error.message + " Status Code: " + status);
        }
    },
    type: 'GitCCSManager'
};]]></script>
        <sys_class_name>sys_script_include</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2020-05-05 15:46:48</sys_created_on>
        <sys_id>d5192a521ba01814c695fc88cc4bcbd7</sys_id>
        <sys_mod_count>19</sys_mod_count>
        <sys_name>GitCCSManager</sys_name>
        <sys_package display_value="Cisco Lab of the Future" source="x_83068_cisco_lab">fe07f0fa1bf78c50c695fc88cc4bcbbc</sys_package>
        <sys_policy/>
        <sys_scope display_value="Cisco Lab of the Future">fe07f0fa1bf78c50c695fc88cc4bcbbc</sys_scope>
        <sys_update_name>sys_script_include_d5192a521ba01814c695fc88cc4bcbd7</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2020-06-09 13:53:31</sys_updated_on>
    </sys_script_include>
</record_update>
